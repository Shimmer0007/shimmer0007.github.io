<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>æŒ‡æŒ¥å®˜æˆ˜æœ¯ç»ˆç«¯ - å…¨ç¾èˆ°èˆ¹æ‰“å¡åœ°å›¾</title>

        <link rel="stylesheet"
            href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
        <link
            href="https://fonts.googleapis.com/css2?family=Exo+2:wght@300;400;700&family=Noto+Sans+SC:wght@300;500&display=swap"
            rel="stylesheet">

        <style>
        :root {
            --al-blue: #1a2a6c;
            --al-gold: #f1c40f;
            --al-purple: #8e44ad;
            --bg-dark: #0f172a;
            --panel-bg: rgba(30, 41, 59, 0.85);
            --text-main: #f8fafc;
        }

        body, html { 
            margin: 0; padding: 0; height: 100%; 
            font-family: 'Exo 2', 'Noto Sans SC', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            overflow: hidden;
        }

        /* åœ°å›¾å®¹å™¨ */
        #map { height: 100vh; width: 100%; z-index: 1; }

        /* ä¾§è¾¹æ è®¾è®¡ - ç»ç’ƒæ‹Ÿæ€ */
        #terminal {
            position: absolute; top: 20px; left: 20px; width: 380px; height: calc(100vh - 40px);
            background: var(--panel-bg);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            z-index: 1000;
            display: flex; flex-direction: column;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
        }

        .header { padding: 20px; border-bottom: 2px solid var(--al-gold); }
        .header h1 { margin: 0; font-size: 1.4rem; letter-spacing: 1px; color: var(--al-gold); }
        .header p { margin: 5px 0 0; font-size: 0.8rem; opacity: 0.8; }

        /* æœç´¢å’Œè¿‡æ»¤ */
        .controls { padding: 15px; background: rgba(0,0,0,0.2); }
        #searchBar {
            width: 100%; padding: 10px; border-radius: 5px; border: none;
            background: #334155; color: white; margin-bottom: 10px; box-sizing: border-box;
        }
        .filters { display: flex; gap: 5px; flex-wrap: wrap; }
        .filter-btn {
            padding: 4px 10px; border-radius: 4px; border: 1px solid var(--al-gold);
            background: transparent; color: var(--al-gold); cursor: pointer; font-size: 0.75rem;
            transition: 0.3s;
        }
        .filter-btn.active, .filter-btn:hover { background: var(--al-gold); color: black; }

        /* åˆ—è¡¨åŒºåŸŸ */
        #ship-list { flex: 1; overflow-y: auto; padding: 10px; scrollbar-width: thin; }
        .ship-card {
            background: rgba(255,255,255,0.05); border-left: 4px solid #ccc;
            margin-bottom: 10px; padding: 12px; border-radius: 4px; cursor: pointer;
            transition: 0.2s; position: relative;
        }
        .ship-card:hover { background: rgba(255,255,255,0.15); transform: translateX(5px); }
        .ship-card.BB { border-color: #ef4444; }
        .ship-card.CV { border-color: #f59e0b; }
        .ship-card.SS { border-color: #10b981; }
        .ship-card.DD { border-color: #3b82f6; }

        .ship-name { font-weight: bold; font-size: 1rem; display: block; }
        .ship-meta { font-size: 0.75rem; opacity: 0.7; margin-top: 4px; }
        .dist-tag { position: absolute; top: 12px; right: 12px; font-size: 0.7rem; color: var(--al-gold); }
        .al-tag { color: #c084fc; font-size: 0.8rem; margin-top: 6px; display: block; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 5px; }

        /* åœ°å›¾ Marker æ ·å¼ */
        .custom-marker {
            width: 30px; height: 30px; border-radius: 50% 50% 50% 0;
            background: var(--al-blue); border: 2px solid white;
            display: flex; align-items: center; justify-content: center;
            color: white; font-weight: bold; font-size: 10px;
            transform: rotate(-45deg);
        }
        .custom-marker span { transform: rotate(45deg); }
        
        /* VT Marker è„‰å†²æ•ˆæœ */
        .vt-pulse {
            width: 15px; height: 15px; background: #861f41; border-radius: 50%;
            box-shadow: 0 0 0 rgba(134, 31, 65, 0.4); animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(134, 31, 65, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(134, 31, 65, 0); }
            100% { box-shadow: 0 0 0 0 rgba(134, 31, 65, 0); }
        }
    </style>
    </head>
    <body>

        <div id="terminal">
            <div class="header">
                <h1>COMMANDER TERMINAL</h1>
                <p>Current Port: <b>Virginia Tech, Blacksburg</b></p>
            </div>

            <div class="controls">
                <input type="text" id="searchBar" placeholder="æœç´¢èˆ°åæˆ–å…³è”ç½‘å...">
                <div class="filters">
                    <button class="filter-btn active"
                        data-type="ALL">å…¨éƒ¨</button>
                    <button class="filter-btn" data-type="BB">æˆ˜åˆ—</button>
                    <button class="filter-btn" data-type="CV">èˆªæ¯</button>
                    <button class="filter-btn" data-type="DD">é©±é€/å·¡æ´‹</button>
                    <button class="filter-btn" data-type="SS">æ½œè‰‡</button>
                </div>
            </div>

            <div id="ship-list">
            </div>
        </div>

        <div id="map"></div>

        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
        <script>
    // åŸºç¡€é…ç½®
    const vtPos = [37.2284, -80.4234];
    const map = L.map('map', { zoomControl: false }).setView([38.0, -96.0], 5);
    
    // ä½¿ç”¨æ·±è‰²åº•å›¾
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; CartoDB'
    }).addTo(map);

    L.control.zoom({ position: 'bottomright' }).addTo(map);

    // å®Œæ•´çš„50æ¡æ•°æ®ï¼ˆç²¾ç‚¼ç‰ˆï¼‰
    const shipData = [
        { name: "USS Wisconsin", type: "BB", loc: [36.8484, -76.2934], city: "Norfolk, VA", al: "è¡£é˜¿åçº§Â·å†·æˆ˜æ”¹" },
        { name: "USS New Jersey", type: "BB", loc: [39.9395, -75.1330], city: "Camden, NJ", al: "èŠ±å›­ (UR)" },
        { name: "USS North Carolina", type: "BB", loc: [34.2364, -77.9544], city: "Wilmington, NC", al: "åŒ—å¡ç½—æ¥çº³ (å…”å…”)" },
        { name: "USS Yorktown (II)", type: "CV", loc: [32.7904, -79.9080], city: "Charleston, SC", al: "çº¦å…‹åŸII (UR)" },
        { name: "USS Laffey (II)", type: "DD", loc: [32.7905, -79.9081], city: "Charleston, SC", al: "æ‹‰è²II (UR)" },
        { name: "USS Massachusetts", type: "BB", loc: [41.7061, -71.1631], city: "Fall River, MA", al: "é©¬è¨è¯¸å¡ (å¤§é©¬)" },
        { name: "USS Alabama", type: "BB", loc: [30.6818, -88.0145], city: "Mobile, AL", al: "é˜¿æ‹‰å·´é©¬ (å—èƒ–çº§)" },
        { name: "USS Missouri", type: "BB", loc: [21.3621, -157.9534], city: "Honolulu, HI", al: "å¯†è‹é‡Œ (æŠ•é™èˆ°)" },
        { name: "USS Iowa", type: "BB", loc: [33.7420, -118.2770], city: "Los Angeles, CA", al: "è¡£é˜¿å" },
        { name: "USS Intrepid", type: "CV", loc: [40.7645, -73.9996], city: "New York, NY", al: "æ— ç•" },
        { name: "USS Lexington (II)", type: "CV", loc: [27.8144, -97.3892], city: "Corpus Christi, TX", al: "åˆ—å…‹æ˜Ÿæ•¦" },
        { name: "USS Hornet (II)", type: "CV", loc: [37.7725, -122.3028], city: "Alameda, CA", al: "å¤§é»„èœ‚II" },
        { name: "USS Midway", type: "CV", loc: [32.7137, -117.1751], city: "San Diego, CA", al: "ä¸­é€”å²›çº§é¦–èˆ°" },
        { name: "USS Kidd", type: "DD", loc: [30.4439, -91.1920], city: "Baton Rouge, LA", al: "åŸºå¾· (å¼—è±å½»çº§)" },
        { name: "USS Cassin Young", type: "DD", loc: [42.3734, -71.0558], city: "Boston, MA", al: "å¼—è±å½»çº§" },
        { name: "USS The Sullivans", type: "DD", loc: [42.8778, -78.8797], city: "Buffalo, NY", al: "è‹åˆ©æ–‡äº”å…„å¼Ÿ" },
        { name: "USS Little Rock", type: "DD", loc: [42.8779, -78.8800], city: "Buffalo, NY", al: "å…‹åˆ©å¤«å…°çº§ (æ”¹)" },
        { name: "USS Salem", type: "DD", loc: [42.2440, -70.9700], city: "Quincy, MA", al: "å¾·æ¢…å› çº§é‡å·¡" },
        { name: "USS Cavalla", type: "SS", loc: [29.3362, -94.7736], city: "Galveston, TX", al: "æ£˜é³ (å¤§å‡¤ä¸€ç”Ÿä¹‹æ•Œ)" },
        { name: "USS Torsk", type: "SS", loc: [39.2858, -76.6084], city: "Baltimore, MD", al: "é»‘é³•é±¼" },
        { name: "USS Bowfin", loc: [21.3688, -157.9392], type: "SS", al: "é•¿é³é²”", city: "Honolulu, HI" },
        { name: "USS Pampanito", loc: [37.8099, -122.4172], type: "SS", al: "æ½˜å¸•å°¼æ‰˜", city: "San Francisco, CA" },
        { name: "USS Nautilus", loc: [41.3869, -72.0880], type: "SS", al: "é¹¦é¹‰èº (æ ¸åŠ¨åŠ›)", city: "Groton, CT" },
        { name: "USS Silversides", loc: [43.2307, -86.3338], type: "SS", al: "é“¶ä¾§é±¼", city: "Muskegon, MI" },
        { name: "USS Cobia", loc: [44.0898, -87.6583], type: "SS", al: "æµ·é²¡", city: "Manitowoc, WI" },
        { name: "USS Drum", loc: [30.6820, -88.0146], type: "SS", al: "é¼“é±¼", city: "Mobile, AL" },
        { name: "USS Cod", loc: [41.5085, -81.6924], type: "SS", al: "é³•é±¼", city: "Cleveland, OH" },
        { name: "USS Requin", loc: [40.4449, -80.0180], type: "SS", al: "é•¿å»é±¼", city: "Pittsburgh, PA" },
        { name: "USS Becuna", loc: [39.9436, -75.1415], type: "SS", al: "ç™½é²‘", city: "Philadelphia, PA" },
        { name: "USS Growler", loc: [40.7646, -73.9997], type: "SS", al: "å’†å“®è€…", city: "New York, NY" },
        { name: "USS Lionfish", loc: [41.7062, -71.1632], type: "SS", al: "ç‹®å­é±¼", city: "Fall River, MA" },
        { name: "USS Batfish", loc: [35.7925, -95.3248], type: "SS", al: "è™è é±¼", city: "Muskogee, OK" },
        { name: "USS Blueback", loc: [45.5117, -122.6659], type: "SS", al: "é’èƒŒé±¼", city: "Portland, OR" },
        { name: "USS Ling", loc: [40.8841, -74.0326], type: "SS", al: "é“ƒé±¼", city: "Hackensack, NJ" },
        { name: "USS Croaker", loc: [42.8780, -78.8798], type: "SS", al: "çŸ³é¦–é±¼", city: "Buffalo, NY" },
        { name: "USS Arizona Mem.", loc: [21.3650, -157.9497], type: "BB", al: "äºšåˆ©æ¡‘é‚£ (å®‰æ¯)", city: "Pearl Harbor, HI" },
        { name: "LST-325", loc: [37.9678, -87.5750], type: "DD", al: "å¦å…‹ç™»é™†èˆ°", city: "Evansville, IN" },
        { name: "USS Olympia", loc: [39.9435, -75.1414], type: "DD", al: "è€å‰è¾ˆ (1892)", city: "Philadelphia, PA" },
        { name: "USS Joseph Kennedy", loc: [41.7060, -71.1630], type: "DD", al: "åŸºæ—çº§", city: "Fall River, MA" },
        { name: "USS Orleck", loc: [30.3235, -81.6560], type: "DD", al: "åŸºæ—çº§", city: "Jacksonville, FL" },
        { name: "USS Stewart", loc: [29.3361, -94.7735], type: "DD", al: "æŠ¤èˆªé©±é€èˆ°", city: "Galveston, TX" },
        { name: "USS Turner Joy", loc: [47.5620, -122.6220], type: "DD", al: "è°¢å°”æ›¼çº§", city: "Bremerton, WA" },
        { name: "USS Edson", loc: [43.6120, -83.8680], type: "DD", al: "è°¢å°”æ›¼çº§", city: "Bay City, MI" },
        { name: "USS Slater", loc: [42.6430, -73.7510], type: "DD", al: "å¤§ç‚® (DE)", city: "Albany, NY" },
        { name: "USS Hazard", loc: [41.2720, -95.9180], type: "DD", al: "æ‰«é›·èˆ°", city: "Omaha, NE" }
    ];

    // è®¡ç®—è·ç¦» (Haversine formula)
    function getDist(lat1, lon1, lat2, lon2) {
        const R = 3958.8; // è‹±é‡Œ
        const dLat = (lat2 - lat1) * Math.PI / 180;
        const dLon = (lon2 - lon1) * Math.PI / 180;
        const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                  Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon/2) * Math.sin(dLon/2);
        return Math.round(R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)));
    }

    // æ¸²æŸ“ä¸»å‡½æ•°
    const listEl = document.getElementById('ship-list');
    let markers = [];

    function renderShips(filterType = 'ALL', searchTerm = '') {
        listEl.innerHTML = '';
        markers.forEach(m => map.removeLayer(m));
        markers = [];

        shipData
            .map(s => ({ ...s, dist: getDist(vtPos[0], vtPos[1], s.loc[0], s.loc[1]) }))
            .sort((a, b) => a.dist - b.dist)
            .filter(s => (filterType === 'ALL' || s.type === filterType) && 
                         (s.name.toLowerCase().includes(searchTerm.toLowerCase()) || s.al.includes(searchTerm)))
            .forEach(ship => {
                // åœ°å›¾ Marker
                const marker = L.marker(ship.loc, {
                    icon: L.divIcon({
                        className: '',
                        html: `<div class="custom-marker" style="background:${getColor(ship.type)}"><span>${ship.type}</span></div>`
                    })
                }).addTo(map);
                
                marker.bindPopup(`<b>${ship.name}</b><br>${ship.city}<br><hr>${ship.al}`);
                markers.push(marker);

                // ä¾§è¾¹æ å¡ç‰‡
                const card = document.createElement('div');
                card.className = `ship-card ${ship.type}`;
                card.innerHTML = `
                    <span class="dist-tag">ğŸ“ ${ship.dist} mi</span>
                    <span class="ship-name">${ship.name}</span>
                    <div class="ship-meta">ğŸ“ ${ship.city} | ${ship.type}</div>
                    <span class="al-tag">ğŸ’  ${ship.al}</span>
                `;
                card.onclick = () => {
                    map.flyTo(ship.loc, 10, { duration: 1.5 });
                    marker.openPopup();
                };
                listEl.appendChild(card);
            });
    }

    function getColor(type) {
        if(type === 'BB') return '#ef4444';
        if(type === 'CV') return '#f59e0b';
        if(type === 'SS') return '#10b981';
        return '#3b82f6';
    }

    // VT Home Marker
    L.marker(vtPos, {
        icon: L.divIcon({ className: '', html: '<div class="vt-pulse"></div>' })
    }).addTo(map).bindPopup("<b>æ¯æ¸¯: Virginia Tech</b>");

    // äº‹ä»¶ç›‘å¬
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.onclick = (e) => {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            renderShips(e.target.dataset.type, document.getElementById('searchBar').value);
        };
    });

    document.getElementById('searchBar').oninput = (e) => {
        const activeType = document.querySelector('.filter-btn.active').dataset.type;
        renderShips(activeType, e.target.value);
    };

    renderShips();
</script>
    </body>
</html>
